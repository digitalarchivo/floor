<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>NFT Strategy mNAV Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  font-family: Inter, system-ui, sans-serif;
  background: #f6f6f6;
  margin: 0;
  padding: 24px;
}

.container {
  max-width: 1100px;
  margin: auto;
  background: #fff;
  border: 1px solid #ddd;
}

.header {
  padding: 20px;
  border-bottom: 2px solid #000;
}

.header h1 {
  margin: 0;
  font-size: 26px;
}

.subtitle {
  color: #555;
  font-style: italic;
  margin-top: 6px;
}

.section-title {
  background: #111;
  color: #fff;
  padding: 10px 16px;
  font-weight: 600;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 12px 14px;
  border-bottom: 1px solid #eee;
  text-align: left;
  font-size: 14px;
}

th {
  background: #fafafa;
  font-weight: 600;
}

.tag {
  background: #ffe6e0;
  color: #c0392b;
  padding: 2px 6px;
  font-size: 12px;
  border-radius: 4px;
  margin-left: 6px;
}

.loading {
  color: #999;
  font-style: italic;
}

.footer {
  padding: 14px;
  font-size: 12px;
  color: #777;
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <h1>Strategy Token mNAV Tracker</h1>
    <div class="subtitle">
      Strategy tokens transform illiquid NFTs into perpetual DeFi engines.
    </div>
  </div>

  <div class="section-title">
    NFT STRATEGY TOKEN MNAV ANALYSIS
  </div>

  <table>
    <thead>
      <tr>
        <th>Collection</th>
        <th>Floor Price (ETH)</th>
        <th>Market Cap (ETH)</th>
        <th>FD Market Cap (ETH)</th>
        <th>mNAV</th>
      </tr>
    </thead>
    <tbody id="nft-table">
      <tr>
        <td colspan="5" class="loading">Loading data…</td>
      </tr>
    </tbody>
  </table>

  <div class="footer">
    Data source: CoinGecko API • For informational purposes only
  </div>

</div>

<script>
const collections = [
  "cryptopunks",
  "meebits",
  "bored-ape-yacht-club",
  "azuki",
  "moonbirds",
  "pudgy-penguins",
  "chimpers",
  "good-vibes-club"
];

const table = document.getElementById("nft-table");

function format(num) {
  if (num === null || num === undefined) return "—";
  return num.toLocaleString(undefined, { maximumFractionDigits: 2 });
}

async function fetchCollection(id) {
  const res = await fetch(`/api/nft?id=${id}`);
  if (!res.ok) {
    throw new Error(`Failed to load ${id}`);
  }
  return res.json();
}

async function loadData() {
  table.innerHTML = "";

  const requests = collections.map(id =>
    fetchCollection(id).then(data => ({ id, data })).catch(err => ({ id, error: err }))
  );

  const results = await Promise.all(requests);

  for (const result of results) {
    const row = document.createElement("tr");

    if (result.error) {
      row.innerHTML = `
        <td>${result.id}</td>
        <td colspan="4" class="loading">Error loading data</td>
      `;
      table.appendChild(row);
      continue;
    }

    const data = result.data;

    const floor = data.floor_price ?? null;
    const marketCap = data.market_cap ?? null;
    const supply = data.total_supply ?? null;

    const fdMarketCap =
      floor && supply ? floor * supply : null;

    const mnav =
      marketCap && fdMarketCap ? fdMarketCap / marketCap : null;

    row.innerHTML = `
      <td>
        ${data.name}
        <span class="tag">${data.symbol?.toUpperCase()}</span>
      </td>
      <td>${format(floor)}</td>
      <td>${format(marketCap)}</td>
      <td>${format(fdMarketCap)}</td>
      <td>${mnav ? mnav.toFixed(2) + "x" : "—"}</td>
    `;

    table.appendChild(row);
  }
}

loadData();
</script>

</body>
</html>
